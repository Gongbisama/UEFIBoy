matrix:
  include:
    # Native OSX builds
    - os: osx
      env: 
        - BUILD=native CC=clang CXX=clang++ FRAMEWORK=SDL
        - BUILD=native CC=clang CXX=clang++ FRAMEWORK=SDL2
      language: c

    # IOS build
    - os: osx
      env: BUILD=IOS BUILD_FOLDER=build/IOS
      language: c
       
    # Linux and other X-platform Docker builds
    - os: linux
      env: 
        global:
            - DOCKER=YES
        matrix:
            - BUILD=linux CC=gcc CXX=g++ FRAMEWORK=SDL MODE=release BUILD_FOLDER=build/Unix
            - BUILD=linux CC=gcc CXX=g++ FRAMEWORK=SDL2 MODE=release BUILD_FOLDER=build/Unix
            - BUILD=psp BUILD_FOLDER=build/PSP
            - BUILD=dreamcast BUILD_FOLDER=build/Dreamcast
            - BUILD=vita BUILD_FOLDER=build/Vita
            - BUILD=emscripten BUILD_FOLDER=build/Javascript
            - BUILD=android BUILD_FOLDER=build/Android
  language: ruby
  services:
    - docker
       
      
install: 
    # Docker build setup  
    - if [ "$DOCKER" == "YES" ]; then docker build -t plutoboy -f $BUILD_FOLDER/Dockerfile .; fi 

    # OSX/IOS build setup 
    - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew update; fi

    # Native OSX build setup
    - if [ "$TRAVIS_OS_NAME" == "osx" ] && [ "$BUILD" == "native" ]; then brew install scons; fi
    - if [ "$TRAVIS_OS_NAME" == "osx" ]; then brew install sdl sdl2 sdl_net sdl2_net; fi

    #Setup SDL2 framework for XCode IOS
    - if [ "$BUILD" == "IOS" ]; then git clone https://github.com/manifest/sdl-ios-framework; fi
    - if [ "$BUILD" == "IOS" ]; then cd sdl-ios-framework; fi 
    - if [ "$BUILD" == "IOS" ]; then gem install colorize; fi 
    - if [ "$BUILD" == "IOS" ]; then rake SDL2:build; fi
    - if [ "$BUILD" == "IOS" ]; then mkdir ~/Library/Frameworks/; fi 
    - if [ "$BUILD" == "IOS" ]; then cp -r build/sdl/SDL2.framework ~/Library/Frameworks/; fi


script: 
    # Docker linux build
    - if [ "$BUILD" == "linux" ]; then docker run -e cc=$CC -e framework=$FRAMEWORK -e mode=$MODE plutoboy_linux; fi

    # Docker x-platform builds
    - if [ "$BUILD" != "linux" ] && [ "$DOCKER" == "YES" ]; then docker run $CONTAINER_NAME

    # Native OSX builds
    - if [ "$BUILD" == "native" ]; then cd build/Unix; fi
    - if [ "$BUILD" == "native" ]; then scons cc=$CC framework=$FRAMEWORK mode=$MODE; fi
   
    # IOS Builds
    - if [ "$BUILD" == "IOS" ]; then cd ~/build/RossMeikleham/PlutoBoy/build/IOS; fi
    - if [ "$BUILD" == "IOS" ]; then xcodebuild -project Plutoboy.xcodeproj -target Plutoboy -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO; fi
